

#include <xc.h>
#include <pic18f4550.h> 

#pragma config PBADEN	= OFF 
#pragma config FOSC 	= HS
#pragma config PWRT 	= OFF
#pragma config BOR 		= OFF
#pragma config ICPRT 	= OFF
#pragma config LVP 		= OFF
#pragma config WDT 		= OFF
#pragma config DEBUG	= OFF
#pragma config CPUDIV	= OSC1_PLL2	


#define _XTAL_FREQ 8000000  


void main(void)
{ 
    TRISD = 0xff;
    TRISB = 0B10000000;
    // B0, B1, B2
    PORTBbits.RB1 =0;
    unsigned char old1 = 0;
    unsigned char del = 30;
    while (1)
    {
        
        for(int i=0 ;i<30;i++){
            PORTBbits.RB2 = 1;
            for(unsigned char j=1; j <= del; j++) {
                __delay_ms(1);
                if(PORTDbits.RD2 == 1 && old1 == 0 && del < 100) {
                del += 10;
                __delay_ms(20);
            }
                old1 = PORTDbits.RD2;
            }
        
            PORTBbits.RB2 = 0;
            unsigned char remaining = 100 - del;
            for(unsigned char j=1; j <= remaining; j++) {
                __delay_ms(1);

                if(PORTDbits.RD2 == 1 && old1 == 0 && del < 100) {
                    del += 10;
                    __delay_ms(20);
                   }
                old1 = PORTDbits.RD2;
                
            }
        }
    }
    return;
}

